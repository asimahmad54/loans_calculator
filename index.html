<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Financial Planning Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            min-height: 100vh;
            color: #333;
        }

        .calculator-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 15px;
            opacity: 0.9;
            font-weight: 400;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 35px;
        }

        .section-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-row {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .input-row .input-group {
            flex: 1;
            margin-bottom: 0;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
            font-size: 14px;
        }

        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 11px 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
            transition: border-color 0.2s;
            font-family: inherit;
        }

        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: #2c3e50;
        }

        .info-text {
            font-size: 13px;
            color: #888;
            margin-top: 6px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-option input[type="radio"] {
            width: auto;
            cursor: pointer;
        }

        .radio-option label {
            margin-bottom: 0;
            font-weight: 400;
            cursor: pointer;
            color: #555;
        }

        .add-loan-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            color: #555;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .add-loan-btn:hover {
            background: #f8f8f8;
            border-color: #2c3e50;
            color: #2c3e50;
        }

        .additional-loan {
            padding: 18px;
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            margin-bottom: 15px;
            position: relative;
        }

        .remove-loan-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #e0e0e0;
            color: #666;
            border: none;
            border-radius: 3px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            transition: all 0.2s;
        }

        .remove-loan-btn:hover {
            background: #d32f2f;
            color: white;
        }

        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calculate-btn:hover {
            background: #1a252f;
        }

        .chart-container {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 4px;
            height: 400px;
        }

        .results {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background: #fafafa;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }

        .results.show {
            display: block;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .result-title {
            font-size: 14px;
            font-weight: 500;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            font-size: 32px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .result-subtitle {
            font-size: 13px;
            color: #888;
        }

        .savings-highlight {
            background: #2c3e50;
            color: white;
            padding: 25px;
            border-radius: 4px;
            text-align: center;
            margin-top: 20px;
        }

        .savings-highlight .amount {
            font-size: 42px;
            font-weight: 600;
            margin: 10px 0;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }

        .comparison-table th {
            background: #2c3e50;
            color: white;
            font-weight: 500;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .comparison-table tr:hover {
            background: #fafafa;
        }

        .highlight-green {
            color: #27ae60;
            font-weight: 500;
        }

        .highlight-red {
            color: #e74c3c;
            font-weight: 500;
        }

        .summary-box {
            padding: 18px;
            border-radius: 4px;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
        }

        .summary-box.education-cost {
            background: #f0f7ff;
            border-color: #2c3e50;
        }

        .summary-box.financial-aid {
            background: #f0f7ff;
            border-color: #2c3e50;
        }

        .summary-box-title {
            font-size: 14px;
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 6px;
        }

        .summary-box-value {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
        }

        .summary-box-subtitle {
            font-size: 13px;
            color: #555;
            margin-top: 4px;
        }

        .savings-message {
            margin-top: 12px;
            padding: 12px;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #27ae60;
        }

        @media (max-width: 768px) {
            .calculator-container {
                margin: 0;
                border-radius: 0;
            }

            .content {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .radio-group {
                flex-direction: column;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <div class="header">
            <h1>College Financial Planning Calculator</h1>
            <p>Compare interest-free loans with traditional FAFSA loans</p>
        </div>

        <div class="content">
            <form id="calculatorForm">
                <div class="section">
                    <h2 class="section-title">Total Cost of School</h2>
                    
                    <div class="input-group">
                        <label>How would you like to enter your school costs?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="costBySemester" name="costType" value="semester" checked>
                                <label for="costBySemester">Per Semester</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="costByYear" name="costType" value="year">
                                <label for="costByYear">Per Year</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="costTotal" name="costType" value="total">
                                <label for="costTotal">Total (4 Years)</label>
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="schoolCost">School Cost Amount</label>
                        <input type="text" id="schoolCost" placeholder="25,000" required>
                        <div class="info-text" id="costInfo">Cost per semester</div>
                    </div>

                    <div class="input-group">
                        <label for="yearsInSchool">Years in School</label>
                        <input type="number" id="yearsInSchool" min="1" max="8" value="4" required>
                    </div>

                    <div class="input-group">
                        <label for="currentGPA">Current GPA (Unweighted)</label>
                        <input type="number" id="currentGPA" min="0" max="4.0" step="0.01" placeholder="3.50">
                        <div class="info-text">Enter your unweighted GPA (0.00 - 4.00)</div>
                        <div id="gpaScholarshipEligibility" style="display: none; margin-top: 8px; padding: 12px; background: #d4edda; border-left: 3px solid #28a745; border-radius: 4px; font-size: 14px; color: #155724;">
                            <strong>Congratulations!</strong> You are eligible for a Jamaat scholarship worth up to $1,000 for maintaining a GPA above 3.5!
                        </div>
                    </div>

                    <div class="summary-box education-cost">
                        <div class="summary-box-title">Total Education Cost</div>
                        <div class="summary-box-value" id="totalEducationCost">$0</div>
                        <div class="summary-box-subtitle">Total amount needed for all years</div>
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">Your Financial Aid Package</h2>
                    
                    <div class="input-group">
                        <label for="scholarships">Scholarships & Grants (Annual)</label>
                        <input type="text" id="scholarships" placeholder="10,000" value="">
                        <div class="info-text">Money you don't have to pay back (enter annual amount)</div>
                    </div>

                    <div class="input-group">
                        <label for="jamaatLoan">Jamaat Educational Loans (Annual)</label>
                        <input type="text" id="jamaatLoan" placeholder="4,000" value="">
                        <div class="info-text">$3,000 - $5,000 per year, 0% interest</div>
                        <div id="jamaatLoanWarning" style="display: none; margin-top: 8px; padding: 10px; background: #fff3cd; border-left: 3px solid #ffc107; border-radius: 4px; font-size: 13px; color: #856404;">
                            <strong>Note:</strong> Jamaat Educational Loans are typically between $3,000 - $5,000 per year.
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="fafsaLoan">FAFSA Loans (Annual)</label>
                        <input type="text" id="fafsaLoan" placeholder="5,500" value="">
                        <div class="info-text">Federal student loans</div>
                    </div>

                    <div class="input-group">
                        <label for="fafsaInterestRate">FAFSA Interest Rate (%)</label>
                        <input type="number" id="fafsaInterestRate" min="0" max="15" step="0.01" value="6.39" required>
                        <div class="info-text">Current federal rates: 6.39% (undergrad), 7.94% (grad), 8.94% (PLUS loans)</div>
                    </div>

                    <div id="additionalLoansContainer"></div>

                    <button type="button" class="add-loan-btn" onclick="addAdditionalLoan()">
                        <span style="font-size: 18px;">+</span> Add Additional Loan
                    </button>

                    <div class="summary-box financial-aid">
                        <div class="summary-box-title">Total Financial Aid</div>
                        <div class="summary-box-value" id="totalFinancialAid">$0</div>
                        <div class="summary-box-subtitle">
                            You are <span id="aidDifference" style="font-weight: 500;">$0</span>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2 class="section-title">Repayment Plan</h2>
                    
                    <div class="input-group">
                        <label for="repaymentPlan">Repayment Period</label>
                        <select id="repaymentPlan" required>
                            <option value="10">Standard (10 years)</option>
                            <option value="15">Extended (15 years)</option>
                            <option value="20">Extended (20 years)</option>
                            <option value="25">Extended (25 years)</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="calculate-btn">Calculate Your Savings</button>
            </form>

            <div id="results" class="results">
                <h2 class="section-title">Your Results</h2>
                
                <div class="result-card">
                    <div class="result-title">Total Education Cost</div>
                    <div class="result-value" id="totalCost">$0</div>
                    <div class="result-subtitle">Total cost of attendance</div>
                </div>

                <div class="result-card">
                    <div class="result-title">Total Amount Borrowed</div>
                    <div class="result-value" id="totalBorrowed">$0</div>
                    <div class="result-subtitle" id="totalBorrowedSubtitle">Jamaat Educational Loans + FAFSA + Additional Loans</div>
                </div>

                <div class="savings-highlight">
                    <div style="font-size: 16px; margin-bottom: 5px; opacity: 0.9;">Your Total Savings</div>
                    <div class="amount" id="totalSavings">$0</div>
                    <div style="font-size: 14px; opacity: 0.9;">By using interest-free Jamaat Educational Loans</div>
                </div>

                <div class="result-card">
                    <div class="result-title">Repayment Comparison Over Time</div>
                    <div class="chart-container">
                        <canvas id="savingsChart"></canvas>
                    </div>
                </div>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Loan Type</th>
                            <th>Principal</th>
                            <th>Interest Paid</th>
                            <th>Total Repayment</th>
                        </tr>
                    </thead>
                    <tbody id="comparisonTableBody">
                    </tbody>
                </table>

                <div class="result-card" style="margin-top: 20px;">
                    <div class="result-title">Monthly Payment Breakdown</div>
                    <div id="monthlyBreakdown"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let additionalLoanCounter = 0;
        let savingsChart = null;

        // Format input with commas as user types
        function formatInputWithCommas(input) {
            let value = input.value.replace(/,/g, '');
            if (value) {
                const num = parseInt(value);
                if (!isNaN(num)) {
                    input.value = num.toLocaleString('en-US');
                }
            }
        }

        // Parse number from formatted input
        function parseNumber(value) {
            if (!value) return 0;
            const cleaned = value.toString().replace(/[$,\s]/g, '');
            return parseFloat(cleaned) || 0;
        }

        // Update cost info text
        function updateCostInfo() {
            const costType = document.querySelector('input[name="costType"]:checked').value;
            const infoText = document.getElementById('costInfo');
            
            if (costType === 'semester') {
                infoText.textContent = 'Cost per semester';
            } else if (costType === 'year') {
                infoText.textContent = 'Cost per year';
            } else {
                infoText.textContent = 'Total cost for 4 years';
            }
        }

        // Calculate total education cost
        function calculateTotalEducationCost() {
            const costType = document.querySelector('input[name="costType"]:checked').value;
            const schoolCost = parseNumber(document.getElementById('schoolCost').value);
            const yearsInSchool = parseInt(document.getElementById('yearsInSchool').value) || 4;
            
            let totalCost = 0;
            if (costType === 'semester') {
                totalCost = schoolCost * 2 * yearsInSchool;
            } else if (costType === 'year') {
                totalCost = schoolCost * yearsInSchool;
            } else {
                totalCost = schoolCost;
            }
            
            document.getElementById('totalEducationCost').textContent = formatCurrency(totalCost);
            updateFinancialAidSummary();
        }

        // Update financial aid summary
        function updateFinancialAidSummary() {
            const costType = document.querySelector('input[name="costType"]:checked').value;
            const schoolCost = parseNumber(document.getElementById('schoolCost').value);
            const yearsInSchool = parseInt(document.getElementById('yearsInSchool').value) || 4;
            
            let totalEducationCost = 0;
            if (costType === 'semester') {
                totalEducationCost = schoolCost * 2 * yearsInSchool;
            } else if (costType === 'year') {
                totalEducationCost = schoolCost * yearsInSchool;
            } else {
                totalEducationCost = schoolCost;
            }

            const scholarshipsAnnual = parseNumber(document.getElementById('scholarships').value);
            const jamaatLoanAnnual = parseNumber(document.getElementById('jamaatLoan').value);
            const fafsaLoanAnnual = parseNumber(document.getElementById('fafsaLoan').value);

            const totalScholarships = scholarshipsAnnual * yearsInSchool;
            const totalJamaatLoan = jamaatLoanAnnual * yearsInSchool;
            const totalFafsaLoan = fafsaLoanAnnual * yearsInSchool;

            let totalAdditionalLoans = 0;
            document.querySelectorAll('.additional-loan').forEach(loanDiv => {
                const amount = parseNumber(loanDiv.querySelector('.additional-loan-amount').value);
                totalAdditionalLoans += amount * yearsInSchool;
            });

            const totalAid = totalScholarships + totalJamaatLoan + totalFafsaLoan + totalAdditionalLoans;
            const difference = totalAid - totalEducationCost;

            document.getElementById('totalFinancialAid').textContent = formatCurrency(totalAid);
            
            const diffElement = document.getElementById('aidDifference');
            if (difference >= 0) {
                diffElement.textContent = formatCurrency(difference) + ' over';
                diffElement.style.color = '#27ae60';
            } else {
                diffElement.textContent = formatCurrency(Math.abs(difference)) + ' under';
                diffElement.style.color = '#e74c3c';
            }
        }

        // Add additional loan
        function addAdditionalLoan() {
            additionalLoanCounter++;
            const container = document.getElementById('additionalLoansContainer');
            
            const loanDiv = document.createElement('div');
            loanDiv.className = 'additional-loan';
            loanDiv.id = `additionalLoan${additionalLoanCounter}`;
            loanDiv.innerHTML = `
                <button type="button" class="remove-loan-btn" onclick="removeAdditionalLoan(${additionalLoanCounter})">Ã—</button>
                <div style="font-weight: 500; margin-bottom: 12px; color: #2c3e50; font-size: 14px;">Additional Loan #${additionalLoanCounter}</div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Annual Amount</label>
                        <input type="text" class="additional-loan-amount" placeholder="Enter amount">
                    </div>
                    <div class="input-group">
                        <label>Interest Rate (%)</label>
                        <input type="number" class="additional-loan-rate" min="0" max="20" step="0.1" value="7.0">
                    </div>
                </div>
            `;
            
            container.appendChild(loanDiv);

            const amountInput = loanDiv.querySelector('.additional-loan-amount');
            amountInput.addEventListener('input', function() {
                formatInputWithCommas(this);
                updateFinancialAidSummary();
            });
        }

        // Remove additional loan
        function removeAdditionalLoan(id) {
            const loanDiv = document.getElementById(`additionalLoan${id}`);
            if (loanDiv) {
                loanDiv.remove();
                updateFinancialAidSummary();
            }
        }

        // Calculate loans
        function calculateLoans() {
            const costType = document.querySelector('input[name="costType"]:checked').value;
            const schoolCost = parseNumber(document.getElementById('schoolCost').value);
            const yearsInSchool = parseInt(document.getElementById('yearsInSchool').value);
            
            let totalEducationCost = 0;
            if (costType === 'semester') {
                totalEducationCost = schoolCost * 2 * yearsInSchool;
            } else if (costType === 'year') {
                totalEducationCost = schoolCost * yearsInSchool;
            } else {
                totalEducationCost = schoolCost;
            }

            const scholarshipsAnnual = parseNumber(document.getElementById('scholarships').value);
            const jamaatLoanAnnual = parseNumber(document.getElementById('jamaatLoan').value);
            const fafsaLoanAnnual = parseNumber(document.getElementById('fafsaLoan').value);
            const fafsaInterestRate = parseFloat(document.getElementById('fafsaInterestRate').value) / 100;
            const repaymentYears = parseInt(document.getElementById('repaymentPlan').value);

            const totalScholarships = scholarshipsAnnual * yearsInSchool;
            const totalJamaatLoan = jamaatLoanAnnual * yearsInSchool;
            const totalFafsaLoan = fafsaLoanAnnual * yearsInSchool;

            const additionalLoans = [];
            document.querySelectorAll('.additional-loan').forEach(loanDiv => {
                const amount = parseNumber(loanDiv.querySelector('.additional-loan-amount').value);
                const rate = parseFloat(loanDiv.querySelector('.additional-loan-rate').value) / 100;
                if (amount > 0) {
                    additionalLoans.push({
                        annual: amount,
                        total: amount * yearsInSchool,
                        rate: rate
                    });
                }
            });

            const totalAdditionalLoans = additionalLoans.reduce((sum, loan) => sum + loan.total, 0);
            const totalBorrowed = totalJamaatLoan + totalFafsaLoan + totalAdditionalLoans;
            const totalAllLoans = totalJamaatLoan + totalFafsaLoan + totalAdditionalLoans;

            const jamaatLoanResult = calculateLoanPayment(totalJamaatLoan, 0, repaymentYears);
            const fafsaLoanResult = calculateLoanPayment(totalFafsaLoan, fafsaInterestRate, repaymentYears);
            
            const additionalLoanResults = additionalLoans.map(loan => 
                calculateLoanPayment(loan.total, loan.rate, repaymentYears)
            );

            const hypotheticalFafsaResult = calculateLoanPayment(totalJamaatLoan, fafsaInterestRate, repaymentYears);
            const totalSavings = hypotheticalFafsaResult.totalInterest;

            const allLoansAtFafsaRate = calculateLoanPayment(totalAllLoans, fafsaInterestRate, repaymentYears);

            const paymentComparison = calculatePaymentComparison(
                totalJamaatLoan, 
                totalFafsaLoan + totalAdditionalLoans,
                fafsaInterestRate, 
                repaymentYears
            );

            document.getElementById('totalCost').textContent = formatCurrency(totalEducationCost);
            document.getElementById('totalBorrowed').textContent = formatCurrency(totalBorrowed);
            
            // Build dynamic subtitle for total borrowed
            let borrowedSubtitle = [];
            if (totalJamaatLoan > 0) borrowedSubtitle.push('Jamaat Educational Loans');
            if (totalFafsaLoan > 0) borrowedSubtitle.push('FAFSA');
            if (totalAdditionalLoans > 0) borrowedSubtitle.push('Additional Loans');
            document.getElementById('totalBorrowedSubtitle').textContent = borrowedSubtitle.join(' + ') || 'No loans selected';
            
            document.getElementById('totalSavings').textContent = formatCurrency(totalSavings);

            const tableBody = document.getElementById('comparisonTableBody');
            tableBody.innerHTML = '';

            if (totalJamaatLoan > 0) {
                tableBody.innerHTML += createTableRow(
                    'Jamaat Educational Loans (0%)',
                    totalJamaatLoan,
                    jamaatLoanResult.totalInterest,
                    jamaatLoanResult.totalPayment,
                    true
                );
            }

            if (totalFafsaLoan > 0) {
                tableBody.innerHTML += createTableRow(
                    `FAFSA Loans (${(fafsaInterestRate * 100).toFixed(1)}%)`,
                    totalFafsaLoan,
                    fafsaLoanResult.totalInterest,
                    fafsaLoanResult.totalPayment,
                    false
                );
            }

            additionalLoans.forEach((loan, index) => {
                tableBody.innerHTML += createTableRow(
                    `Additional Loan #${index + 1} (${(loan.rate * 100).toFixed(1)}%)`,
                    loan.total,
                    additionalLoanResults[index].totalInterest,
                    additionalLoanResults[index].totalPayment,
                    false
                );
            });

            // Add total row for actual loans
            const totalActualInterest = jamaatLoanResult.totalInterest + fafsaLoanResult.totalInterest + 
                                       additionalLoanResults.reduce((sum, result) => sum + result.totalInterest, 0);
            const totalActualPayment = jamaatLoanResult.totalPayment + fafsaLoanResult.totalPayment + 
                                      additionalLoanResults.reduce((sum, result) => sum + result.totalPayment, 0);

            tableBody.innerHTML += `
                <tr style="background: #f0f7ff; font-weight: 500; border-top: 2px solid #2c3e50;">
                    <td><strong>TOTAL (Your Loans)</strong></td>
                    <td><strong>${formatCurrency(totalAllLoans)}</strong></td>
                    <td class="highlight-green"><strong>${formatCurrency(totalActualInterest)}</strong></td>
                    <td><strong>${formatCurrency(totalActualPayment)}</strong></td>
                </tr>
            `;

            tableBody.innerHTML += `
                <tr style="background: #fff5f5; font-weight: 500; border-bottom: 2px solid #2c3e50;">
                    <td>If ALL Loans were FAFSA (${(fafsaInterestRate * 100).toFixed(1)}%)</td>
                    <td>${formatCurrency(totalAllLoans)}</td>
                    <td class="highlight-red">${formatCurrency(allLoansAtFafsaRate.totalInterest)}</td>
                    <td class="highlight-red">${formatCurrency(allLoansAtFafsaRate.totalPayment)}</td>
                </tr>
            `;

            const monthlyBreakdown = document.getElementById('monthlyBreakdown');
            let breakdownHTML = '<div style="margin-top: 10px;">';
            
            if (totalJamaatLoan > 0) {
                breakdownHTML += `<p style="margin-bottom: 8px;"><strong>Jamaat Educational Loans:</strong> ${formatCurrency(jamaatLoanResult.monthlyPayment)}/month</p>`;
            }
            if (totalFafsaLoan > 0) {
                breakdownHTML += `<p style="margin-bottom: 8px;"><strong>FAFSA Loans:</strong> ${formatCurrency(fafsaLoanResult.monthlyPayment)}/month</p>`;
            }
            additionalLoans.forEach((loan, index) => {
                breakdownHTML += `<p style="margin-bottom: 8px;"><strong>Additional Loan #${index + 1}:</strong> ${formatCurrency(additionalLoanResults[index].monthlyPayment)}/month</p>`;
            });
            
            const totalMonthly = jamaatLoanResult.monthlyPayment + fafsaLoanResult.monthlyPayment + 
                                additionalLoanResults.reduce((sum, result) => sum + result.monthlyPayment, 0);
            breakdownHTML += `<p style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;"><strong>Total Monthly Payment:</strong> <span style="color: #2c3e50; font-size: 20px; font-weight: 600;">${formatCurrency(totalMonthly)}</span></p>`;
            
            breakdownHTML += `<p style="margin-top: 10px; color: #888;"><strong>If all loans were FAFSA:</strong> ${formatCurrency(allLoansAtFafsaRate.monthlyPayment)}/month</p>`;
            
            // Calculate monthly savings
            const monthlySavings = allLoansAtFafsaRate.monthlyPayment - totalMonthly;
            if (monthlySavings > 0) {
                breakdownHTML += `<div class="savings-message"><strong>By using Jamaat Loans, you save ${formatCurrency(monthlySavings)}/month</strong></div>`;
            }
            
            breakdownHTML += '</div>';
            
            monthlyBreakdown.innerHTML = breakdownHTML;

            createPaymentChart(paymentComparison, repaymentYears);

            document.getElementById('results').classList.add('show');
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Calculate payment comparison over time
        function calculatePaymentComparison(jamaatPrincipal, otherLoansWithInterest, fafsaRate, years) {
            const monthlyRate = fafsaRate / 12;
            const numPayments = years * 12;
            
            const totalPrincipal = jamaatPrincipal + otherLoansWithInterest;
            
            if (totalPrincipal === 0) {
                return { actualPayments: [], fafsaPayments: [] };
            }

            const jamaatMonthlyPayment = jamaatPrincipal > 0 ? jamaatPrincipal / numPayments : 0;
            const otherMonthlyPayment = otherLoansWithInterest > 0 ? 
                otherLoansWithInterest * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                (Math.pow(1 + monthlyRate, numPayments) - 1) : 0;
            
            const actualMonthlyPayment = jamaatMonthlyPayment + otherMonthlyPayment;
            
            const allAtFafsaMonthlyPayment = totalPrincipal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                            (Math.pow(1 + monthlyRate, numPayments) - 1);
            
            const actualPayments = [];
            const fafsaPayments = [];
            
            for (let month = 0; month <= numPayments; month++) {
                actualPayments.push(actualMonthlyPayment * month);
                fafsaPayments.push(allAtFafsaMonthlyPayment * month);
            }
            
            return { actualPayments, fafsaPayments };
        }

        // Create payment comparison chart
        function createPaymentChart(paymentData, years) {
            const ctx = document.getElementById('savingsChart');
            
            if (savingsChart) {
                savingsChart.destroy();
            }

            const labels = [];
            const actualYearlyData = [];
            const fafsaYearlyData = [];
            const monthsPerYear = 12;
            
            for (let year = 0; year <= years; year++) {
                labels.push(`Year ${year}`);
                const index = year * monthsPerYear;
                actualYearlyData.push(paymentData.actualPayments[index]);
                fafsaYearlyData.push(paymentData.fafsaPayments[index]);
            }

            savingsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Your Loans (Jamaat + FAFSA + Other)',
                            data: actualYearlyData,
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.05)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: '#27ae60',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'If All Loans Were FAFSA',
                            data: fafsaYearlyData,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.05)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointBackgroundColor: '#e74c3c',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12,
                                    weight: '500'
                                },
                                color: '#555',
                                usePointStyle: true,
                                padding: 15,
                                boxWidth: 6,
                                boxHeight: 6
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.parsed.y) + ' paid';
                                }
                            },
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: {
                                size: 13
                            },
                            bodyFont: {
                                size: 12
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cumulative Amount Paid',
                                font: {
                                    size: 12,
                                    weight: '500'
                                },
                                color: '#555'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                },
                                font: {
                                    size: 11
                                },
                                color: '#888'
                            },
                            grid: {
                                color: '#e0e0e0',
                                drawBorder: false
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Repayment Period',
                                font: {
                                    size: 12,
                                    weight: '500'
                                },
                                color: '#555'
                            },
                            ticks: {
                                font: {
                                    size: 11
                                },
                                color: '#888'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Calculate loan payment
        function calculateLoanPayment(principal, annualRate, years) {
            if (principal === 0) {
                return {
                    monthlyPayment: 0,
                    totalPayment: 0,
                    totalInterest: 0
                };
            }

            if (annualRate === 0) {
                const monthlyPayment = principal / (years * 12);
                return {
                    monthlyPayment: monthlyPayment,
                    totalPayment: principal,
                    totalInterest: 0
                };
            }

            const monthlyRate = annualRate / 12;
            const numPayments = years * 12;
            
            const monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                                  (Math.pow(1 + monthlyRate, numPayments) - 1);
            
            const totalPayment = monthlyPayment * numPayments;
            const totalInterest = totalPayment - principal;

            return {
                monthlyPayment: monthlyPayment,
                totalPayment: totalPayment,
                totalInterest: totalInterest
            };
        }

        // Create table row
        function createTableRow(loanType, principal, interest, total, isGood) {
            const interestClass = isGood ? 'highlight-green' : '';
            return `
                <tr>
                    <td><strong>${loanType}</strong></td>
                    <td>${formatCurrency(principal)}</td>
                    <td class="${interestClass}">${formatCurrency(interest)}</td>
                    <td>${formatCurrency(total)}</td>
                </tr>
            `;
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Event listeners
        document.querySelectorAll('input[name="costType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                updateCostInfo();
                calculateTotalEducationCost();
            });
        });

        document.getElementById('schoolCost').addEventListener('input', function() {
            formatInputWithCommas(this);
            calculateTotalEducationCost();
        });

        document.getElementById('yearsInSchool').addEventListener('input', calculateTotalEducationCost);

        // GPA scholarship eligibility check
        document.getElementById('currentGPA').addEventListener('input', function() {
            const gpa = parseFloat(this.value);
            const notification = document.getElementById('gpaScholarshipEligibility');
            
            if (gpa > 3.5 && gpa <= 4.0) {
                notification.style.display = 'block';
            } else {
                notification.style.display = 'none';
            }
        });

        ['scholarships', 'jamaatLoan', 'fafsaLoan'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                formatInputWithCommas(this);
                updateFinancialAidSummary();
                
                // Check Jamaat loan amount
                if (id === 'jamaatLoan') {
                    const amount = parseNumber(this.value);
                    const warning = document.getElementById('jamaatLoanWarning');
                    if (amount > 5000) {
                        warning.style.display = 'block';
                    } else {
                        warning.style.display = 'none';
                    }
                }
            });
        });

        document.getElementById('calculatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateLoans();
        });

        // Initialize
        updateCostInfo();
    </script>
</body>
</html>
